<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>فعال‌سازی حساب</title>
<link rel="stylesheet" href="../css/otp.css"/><link rel="stylesheet" href="../css/colors.css"/><link rel="stylesheet" href="../fonts/fonts.css"/>
<style>.message{padding:12px;margin:10px 0;border-radius:5px;text-align:center;display:none}.message.success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}.message.error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}</style>
</head>
<body>
<div id="vanta-bg"></div>
<div class="register_bacground">
  <div class="otp_container">
    <div class="otp_title"><span>فعال‌سازی حساب کاربری</span></div>
    <div class="otp_form">
      <form id="activationForm">
        <input type="text" id="uid" placeholder="UID" required/>
        <input type="text" id="token" placeholder="Token" required/>
        <input type="submit" value="فعال‌سازی" id="actBtn"/>
      </form>
      <div id="message" class="message"></div>
    </div>
  </div>
</div>
<script src="../js/libraries/register-bg.js"></script>
<script src="../js/libraries/register-bg2.js"></script>
<script type="module" src="utils.js"></script>
<script>
const API_BASE="https://atom-game.ir";
// showMsg imported from utils.js
// function showMsg(type,text){const b=document.getElementById("message");b.className="message "+type;b.innerText=text;b.style.display="block";}
// normalizeErrors imported from utils.js
// function normalizeErrors(data){if(!data)return"خطای ناشناخته.";if(typeof data==="string")return data;if(Array.isArray(data))return data.join("، ");if(data.detail)return data.detail;return Object.entries(data).map(([k,v])=>`${k}: ${v}`).join(" | ");}

document.getElementById("activationForm").addEventListener("submit",async e=>{
 e.preventDefault();showMsg("","");document.getElementById("message").style.display="none";
 const btn=document.getElementById("actBtn");btn.disabled=true;btn.value="درحال فعال‌سازی...";
 const payload={uid:uid.value.trim(),token:token.value.trim()};
 try{
  const res=await safeFetch(`${API_BASE}/auth/users/activation/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
  const data=await res.json();
  if(res.ok){showMsg("success","حساب با موفقیت فعال شد!");setTimeout(()=>location.href="login.html",2000);}
  else{showMsg("error",normalizeErrors(data));}
 }catch(err){showMsg("error","خطا در ارتباط با سرور");}
 finally{btn.disabled=false;btn.value="فعال‌سازی";}
});

// اگر uid و token در URL باشند، فرم پر می‌شود
const p=new URLSearchParams(location.search);
if(p.get("uid")) uid.value=p.get("uid");
if(p.get("token")) token.value=p.get("token");
</script>
</body>
</html>
