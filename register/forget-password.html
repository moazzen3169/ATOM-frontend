<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>بازیابی رمز</title>
  <link rel="stylesheet" href="../css/login.css" />
  <link rel="stylesheet" href="../css/colors.css" />
  <link rel="stylesheet" href="../fonts/fonts.css" />
  <style>.message{padding:12px;margin:10px 0;border-radius:5px;text-align:center;display:none}.message.success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}.message.error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}</style>
</head>
<body>
<div id="vanta-bg"></div>
<div class="register_bacground">
  <div class="register_container">
    <div class="login_title"><span>فراموشی رمز عبور</span></div>
    <div class="login_form">
      <form id="resetForm">
        <input type="email" id="email" placeholder="ایمیل" required />
        <input type="submit" id="resetBtn" value="ارسال لینک بازیابی" />
      </form>
      <div id="message" class="message"></div>
    </div>
    <div class="login_bottom_links">
      <a href="login.html">اگر حساب دارید <div class="blue">ورود کنید</div></a>
      <a href="signup.html">اگر حساب ندارید <div class="blue">ثبت نام کنید</div></a>
    </div>
  </div>
</div>
<script src="../js/libraries/register-bg.js"></script>
<script src="../js/libraries/register-bg2.js"></script>
<script>
const API_BASE="https://atom-game.ir";
function showMsg(type,text){const b=document.getElementById("message");b.className="message "+type;b.innerText=text;b.style.display="block";}
function normalizeErrors(data){if(!data)return"خطای ناشناخته.";if(typeof data==="string")return data;if(Array.isArray(data))return data.join("، ");if(data.detail)return data.detail;return Object.entries(data).map(([k,v])=>`${k}: ${v}`).join(" | ");}

document.getElementById("resetForm").addEventListener("submit",async e=>{
 e.preventDefault();showMsg("","");document.getElementById("message").style.display="none";
 const btn=document.getElementById("resetBtn");btn.disabled=true;btn.value="درحال ارسال...";
 try{
  const res=await fetch(`${API_BASE}/auth/users/reset_password/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:email.value})});
  const data=await res.json();
  if(res.ok){showMsg("success","اگر ایمیل معتبر باشد لینک بازیابی ارسال خواهد شد.");}
  else{showMsg("error",normalizeErrors(data));}
 }catch(err){showMsg("error","خطا در اتصال به سرور");}
 finally{btn.disabled=false;btn.value="ارسال لینک بازیابی";}
});
</script>
</body>
</html>

